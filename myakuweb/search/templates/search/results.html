{% extends "search/base.html" %}
{% load humanize %}

{% block tile_content %}
<div class="row mb-3">
  <div class="col-12 col-lg-9">
    <div class="mr-lg-3 h-100">
      <div class="row card h-100 my-auto py-2 shadow-sm">
        <div class="col px-3">
          <h3 class="d-inline">
            Articles
            <small class="text-muted">
              â€” {{ query_result_set.article_count|intcomma }} found
            </small>
            <small class="text-muted d-none d-md-inline">
              with {{ query_result_set.instance_count|intcomma }}
              instance{{ query_result_set.instance_count|pluralize }} in total
            </small>
          </h3>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-3 d-none d-lg-block d-xl-block">
    <div class="h-100">
      <div class="row card h-100 my-auto py-2 shadow-sm">
        <div class="col resource-tile">
          <h4 class="d-inline">More Resources</h4>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col col-lg-9">
    <div class="mr-lg-3">
      {% for result in query_result_set.ranked_article_results %}
        <div class="row mb-3 card shadow-sm result-tile">
          <div class="col-12 pt-3 px-3">
            <h4>
              <a class="article-title" href="{{ result.article.source_url }}">
                {{ result.article.title }}
              </a>
            </h4>

            <div>
              <span class="article-info-text">
                {{ result.article.source_name }}
                - {{ result.publication_date_str|capfirst }} 
              </span>
              {% if result.display_last_updated_date %}
                <span class="article-info-text d-none d-md-inline">
                  (Updated {{ result.last_updated_date_str }})
                </span>
              {% endif %}
              <span class="article-info-text d-none d-md-inline">
                - {{ result.instance_count|intcomma }} instance{{ result.instance_count|pluralize }}
              </span>
            </div>
            {% if result.display_last_updated_date %}
              <div class="d-md-none">
                  <span class="article-info-text">
                    Updated {{ result.last_updated_date_str }}
                  </span>
              </div>
            {% endif %}
            <div class="d-md-none">
              <span class="article-info-text">
                {{ result.instance_count|intcomma }} instance{{ result.instance_count|pluralize }}
              </span>
            </div>

            <div class="">
              {% for tag in result.tags %}
                <span class="badge badge-info tag-badge">{{ tag }}</span>
              {% endfor %}
            </div>

            <hr>
            <blockquote class="mb-3 article-sample-text">
              <p class="mb-0">
                {% for segment in result.main_matching_sentence.segments %}
                  {% if segment.is_query_match %}
                    <span class="article-sample-instance">{{ segment.segment_text }}</span>
                  {% else %}
                    {{ segment.segment_text }}
                  {% endif %}
                {% endfor %}
              </p>
              <footer class="blockquote-footer">
                {{ result.main_matching_sentence.article_pos_humanized }}
              </footer>
            </blockquote>
            {% if result.more_matching_sentences %}
              <div id="more-samples-{{ forloop.counter }}" class="collapse extra-sample-instances">
                <ul class="list-unstyled mb-3 article-sample-text">
                {% for matching_sentence in result.more_matching_sentences %}
                  <li>
                    <blockquote>
                      <p class="mb-0">
                        {% for segment in matching_sentence.segments %}
                          {% if segment.is_query_match %}
                            <span class="article-sample-instance">{{ segment.segment_text }}</span>
                          {% else %}
                            {{ segment.segment_text }}
                          {% endif %}
                        {% endfor %}
                      </p>
                      <footer class="blockquote-footer">
                        {{ matching_sentence.article_pos_humanized }}
                      </footer>
                    </blockquote>
                  </li>
                {% endfor %}
                </ul>
              </div>
            {% endif %}
          </div>
          {% if result.more_matching_sentences %}
            <div class="col-12 px-0">
              <div class="card-footer text-center py-0">
                <button class="btn btn-link text-muted show-more-button" type="button"
                    data-toggle="collapse" data-target="#more-samples-{{ forloop.counter }}">
                  Show more {{ query }} instances from this article
                </button>
              </div>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="col-lg-3 d-none d-lg-block d-xl-block">
    <div class="">
      {% for link_set in resource_links.resource_link_sets %}
        <div class="row mb-3">
          <div class="col card resource-tile pt-2 shadow-sm">
            <h5 class="light-header">{{ link_set.set_name }}</h5>
            <ul class="list-unstyled">
              {% for resource_link in link_set.resource_links %}
                <li><a class="resource-link" href="{{ resource_link.link }}">
                    Search {{ resource_link.resource_name }} for {{ query }}
                </a></li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
