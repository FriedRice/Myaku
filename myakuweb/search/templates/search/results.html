{% extends "search/base.html" %}

{% block tile_content %}
<div class="row mb-3">
  <div class="col-12 col-lg-9">
    <div class="mr-lg-3 h-100">
      <div class="row card h-100 my-auto py-2 shadow-sm">
        <div class="col px-3">
          <h3 class="d-inline">
            Articles
            <small class="text-muted">
              â€” {{ query_result_set.article_count }}
              article{{ query_result_set.article_count|pluralize }} and
              {{ query_result_set.instance_count }}
              instance{{ query_result_set.instance_count|pluralize }} found
            </small>
          </h3>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-3 d-none d-lg-block d-xl-block">
    <div class="h-100">
      <div class="row card h-100 my-auto py-2 shadow-sm">
        <div class="col resource-tile">
          <h4 class="d-inline">More Resources</h4>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col col-lg-9">
    <div class="mr-lg-3">
      {% for result in query_result_set.ranked_article_results %}
        <div class="row mb-3 card shadow-sm">
          <div class="col-12 pt-3 px-3">
            <h4>
              <a class="article-title" href="{{ result.article.metadata.source_url }}">
                {{ result.article.metadata.title }}
              </a>
            </h4>

            <div>
              <span class="article-info-text">
                {{ result.article.metadata.source_name }}
                - {{ result.article.metadata.publication_datetime|date:"M jS, Y" }} 
                {% if result.article.metadata.publication_datetime != result.article.metadata.last_updated_datetime %}
                  (Updated {{ result.article.metadata.last_updated_datetime|date:"M jS, Y" }})
                {% endif %}
                - {{ result.instance_count }} instance{{ result.instance_count|pluralize }}
              </span>
            </div>

            <div class="">
              {% for tag in result.tags %}
                <span class="badge badge-info tag-badge">{{ tag }}</span>
              {% endfor %}
            </div>

            <hr>
            <blockquote class="mb-3 article-sample-text">
              <p class="mb-0">
                {{ result.main_instance_result.sentence_start_text}}
                <span class="article-sample-instance">
                  {{ result.main_instance_result.instance_text }}
                </span>
                {{ result.main_instance_result.sentence_end_text }}
              </p>
              <footer class="blockquote-footer">
                  {{ result.main_instance_result.pos_percent }}% into article
              </footer>
            </blockquote>
            {% if result.more_instance_results %}
              <div id="more-samples-{{ forloop.counter }}" class="collapse">
                <ul class="list-unstyled mb-3 article-sample-text">
                {% for instance_result in result.more_instance_results %}
                  <li>
                    <blockquote>
                      <p class="mb-0">
                        {{ instance_result.sentence_start_text}}
                        <span class="article-sample-instance">
                          {{ instance_result.instance_text }}
                        </span>
                        {{ instance_result.sentence_end_text }}
                      </p>
                      <footer class="blockquote-footer">
                        {{ instance_result.pos_percent }}% into article
                      </footer>
                    </blockquote>
                  </li>
                {% endfor %}
                </ul>
              </div>
            {% endif %}
          </div>
          {% if result.more_instance_results %}
            <div class="col-12 px-0">
              <div class="card-footer text-center py-0">
                <button class="btn btn-link text-muted" type="button" data-toggle="collapse"
                    data-target="#more-samples-{{ forloop.counter }}">
                  Show more {{ query }} instances from this article
                </button>
              </div>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="col-lg-3 d-none d-lg-block d-xl-block">
    <div class="">
      {% for link_set in resource_links.resource_link_sets %}
        <div class="row mb-3">
          <div class="col card resource-tile pt-2 shadow-sm">
            <h5 class="light-header">{{ link_set.set_name }}</h5>
            <ul class="list-unstyled">
              {% for resource_link in link_set.resource_links %}
                <li><a class="resource-link" href="{{ resource_link.link }}">
                    Search {{ resource_link.resource_name }} for {{ query }}
                </a></li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
