{% extends "search/base.html" %}
{% load humanize %}

{% block tile_content %}
<div class="result-tile-container">
  <section class="tile results-header-tile">
    <h3>
      <span>
        Articles
        <small>â€” {{ query_result_set.total_results|intcomma }} found</small>
      </span>
    {% if page_num != 1 or query_result_set.next_page_num %}
      <small class="result-header-page-number">Page {{ page_num }}</small>
    {% endif %}
    </h3>
  </section>

  {% for result in query_result_set.ranked_article_results %}
    <section class="tile result-tile">
      <h4 class="main-tile-header japanese-text" lang="ja">
        <a href="{{ result.article.source_url }}">{{ result.article.title }}</a>
      </h4>

      <ul class="article-info">
        <li>{{ result.article.source_name }}</li>
        <li>
          <time datetime="{{ result.publication_datetime_isoformat }}">{{ result.publication_date_str|capfirst }}</time>
        </li>
        {% if result.display_last_updated_date %}
          <li class="updated-datetime">Updated <time datetime="{{ result.last_updated_datetime_isoformat }}">{{ result.last_updated_date_str }}</time></li>
        {% endif %}
        <li>{{ result.instance_count|intcomma }} instance{{ result.instance_count|pluralize }}</li>
      </ul>

      <ul class="article-tags">
        {% for tag in result.tags %}
          <li class="tag-badge">{{ tag }}</li>
        {% endfor %}
      </ul>

      <hr>

      <blockquote class="article-sample-text">
        <p class="japanese-text" lang="ja">
          {% for segment in result.preview.main_sample_text.segments %}
            {% if segment.is_query_match %}
              <span class="article-sample-instance">{{ segment.text }}</span>
            {% else %}
              {{ segment.text }}
            {% endif %}
          {% endfor %}
        </p>
        <footer>
          {{ result.preview.main_sample_text.get_humanized_text_position }}
        </footer>
      </blockquote>
      {% if result.preview.extra_sample_texts %}
        <div id="more-samples-{{ forloop.counter }}" class="collapse more-samples-container">
          <ul class="more-samples-list">
          {% for sample_text in result.preview.extra_sample_texts %}
            <li>
              <blockquote class="article-sample-text">
                <p class="japanese-text" lang="ja">
                  {% for segment in sample_text.segments %}
                    {% if segment.is_query_match %}
                      <span class="article-sample-instance">{{ segment.text }}</span>
                    {% else %}
                      {{ segment.text }}
                    {% endif %}
                  {% endfor %}
                </p>
                <footer>
                  {{ sample_text.get_humanized_text_position }}
                </footer>
              </blockquote>
            </li>
          {% endfor %}
          </ul>
        </div>
      {% endif %}
      {% if result.preview.extra_sample_texts %}
        <footer class="tile-footer">
          <button class="button-link show-more-button" type="button"
              data-target="#more-samples-{{ forloop.counter }}">
            Show more <span class="japanese-text" lang="ja">{{ query }}</span> instances from this article
          </button>
        </footer>
      {% endif %}
    </section>
  {% endfor %}

  {% if query_result_set.ranked_article_results %}
    <section class="tile page-nav-tile">
      {% if query_result_set.previous_page_num %}
        <a href="/?q={{ query }}&conv={{ convert_type }}&p={{ query_result_set.previous_page_num }}"
          class="page-nav-long"
        >
          <i class="fa fa-arrow-left"></i> Previous Articles
        </a>
        <a href="/?q={{ query }}&conv={{ convert_type }}&p={{ query_result_set.previous_page_num }}"
          class="page-nav-short"
        >
          <i class="fa fa-arrow-left"></i> Previous
        </a>
      {% endif %}

      <a href="#">Top</a>

      {% if query_result_set.next_page_num and page_num == max_page_num %}
        <span class="page-info-long">Max page reached</span>
        <span class="page-info-short">Max page</span>

      {% elif query_result_set.next_page_num %}
        <a href="/?q={{ query }}&conv={{ convert_type }}&p={{ query_result_set.next_page_num }}"
          class="page-nav-long"
        >
          More Articles <i class="fa fa-arrow-right"></i>
        </a>
        <a href="/?q={{ query }}&conv={{ convert_type }}&p={{ query_result_set.next_page_num }}"
          class="page-nav-short"
        >
          More <i class="fa fa-arrow-right"></i>
        </a>

      {% else %}
        <span class="page-info-long">End of results</span>
        {% if page_num == 1 %}
          <span class="page-info-short">End of results</span>
        {% else %}
          <span class="page-info-short">End</span>
        {% endif %}
      {% endif %}

    </section>
  {% endif %}
</div>

<aside class="resource-links-aside">
  <section class="tile aside-tile resource-header-tile">
    <h4>More Resources</h4>
  </section>
  {% for link_set in resource_links.resource_link_sets %}
    <section class="tile aside-tile resource-links-tile">
      <h5>{{ link_set.set_name }}</h5>
      <ul class="resource-links-list">
        {% for resource_link in link_set.resource_links %}
          <li><a href="{{ resource_link.link }}">
              Search {{ resource_link.resource_name }} for
                <span class="japanese-text" lang="ja">{{ query }}</span>
          </a></li>
        {% endfor %}
      </ul>
    </section>
  {% endfor %}
</aside>

{% endblock %}
